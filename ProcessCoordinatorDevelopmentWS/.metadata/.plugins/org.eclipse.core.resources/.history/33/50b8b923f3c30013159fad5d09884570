package com.marisoft.ziba.cep.jms;

import java.io.File;
import java.net.URI;
import java.net.URISyntaxException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jms.core.JmsTemplate;

import com.espertech.esper.client.Configuration;
import com.espertech.esper.client.EPAdministrator;
import com.espertech.esper.client.EPRuntime;
import com.espertech.esper.client.EPServiceProvider;
import com.espertech.esper.client.EPServiceProviderManager;
import com.espertech.esper.client.EPStatement;

public class EsperEventProcessingAgent {

	@Autowired
	private JmsTemplate jmsTemplate;
	
	public void config(URI configFileURI) {
		
	}	
		
	public void start() throws URISyntaxException {
		File file = new File(this.getClass().getClassLoader().getResource("META-INF/esper.cfg.xml").toURI());
		
		Configuration configuration = new Configuration();
		configuration.configure(file);
		
		EPServiceProvider cepService = EPServiceProviderManager.getProvider("BusinessProcessEvents", configuration);
		EPRuntime cepServiceRT = cepService.getEPRuntime();
		EPAdministrator cepAdmin = cepService.getEPAdministrator();
		
		EPStatement stmt = cepAdmin.createEPL("select * from MyInputEvent");
		
		
		stmt.addListener(new MyInputEventListener(jmsTemplate));
		
		System.out.println("Loaded Successfully");
	}

}
